(function($){$.fn.center=function(){this.animate({top:($(window).height()-this.height())/2+$(window).scrollTop()+"px",left:($(window).width()-this.width())/2+$(window).scrollLeft()+"px"},200);return this};$.urlParam=function(name){var results=new RegExp("[\\?&]"+name+"=([^&#]*)").exec(window.location.href);if(!results){return 0}return results[1]||0};$.fn.picasaGallery=function(options){$.extend({username:""},options);this.each(function(){var albums=$("#albums"),lightbox=$(".lightbox"),albumListWrap,albumsList=(window.localStorage&&window.localStorage.picasaAlbumTitles)?window.localStorage.picasaAlbumTitles:[],loader=$(".loader"),supportsLocalStorage=(function(){return("localStorage" in window)&&window.localStorage!==null})();that="";var PicasaGallery={init:function(){that=this;if(supportsLocalStorage){document.getElementById("clearCache").style.display="block";this.clearCache()}this.loadPicasaAlbums()},loadPicasaAlbums:function(){if(!supportsLocalStorage||!window.localStorage.picasaAlbumsThumbs){if(this.checkUrlKey("id")){return}$.getJSON("http://picasaweb.google.com/data/feed/api/user/"+options.username+"?alt=json&callback=?",function(data){var contents=[];$.each(data.feed.entry,function(index){contents.push('<li><a title="'+data.feed.entry[index].title.$t+'" class="album" href="?id='+data.feed.entry[index].gphoto$id.$t+'" id="'+data.feed.entry[index].gphoto$id.$t+'" data-orig-href="'+data.feed.entry[index].link[1].href+'"><img src="'+data.feed.entry[index].media$group.media$thumbnail[0].url+'" alt="" /><span>'+data.feed.entry[index].title.$t+'</span><span class="count">'+data.feed.entry[index].gphoto$numphotos.$t+"</span></a></li>");albumsList.push('<li><a href="?id='+data.feed.entry[index].gphoto$id.$t+'" class="album" id="'+data.feed.entry[index].gphoto$id.$t+'" data-orig-href="'+data.feed.entry[index].link[1].href+'">'+data.feed.entry[index].title.$t+"</a></li>")});albums.append(contents.join(""));supportsLocalStorage&&(window.localStorage.picasaAlbumTitles=albumsList.join(""));supportsLocalStorage&&(window.localStorage.picasaAlbumsThumbs=contents.join(""));that.dropdownAlbums();albums.find("a").click(function(){that.loadAlbum(this);return false})})}else{this.dropdownAlbums();if(!this.checkUrlKey("id")){albums[0].innerHTML=window.localStorage&&localStorage.picasaAlbumsThumbs}}albums.find("a").click(function(){that.loadAlbum(this);return false})},dropdownAlbums:function(){var proceed=true;if(albumsList.length===0){proceed=false;$.getJSON("http://picasaweb.google.com/data/feed/api/user/jeffway21?alt=json&callback=?",function(data){$.each(data.feed.entry,function(index){albumsList.push('<li><a href="?id='+data.feed.entry[index].gphoto$id.$t+'" class="album" id="'+data.feed.entry[index].gphoto$id.$t+'" data-orig-href="'+data.feed.entry[index].link[1].href+'">'+data.feed.entry[index].title.$t+"</a></li>")});albumsList=albumsList.join("");proceed=true})}(function checkProceed(){if(proceed){albumListWrap=$("#albumsListWrap");var albumOptionsUl=albumListWrap.find("#albumList");albumListWrap.append('<ul id="albumList">'+((window.localStorage&&window.localStorage.picasaAlbumTitles)||albumsList)+"</ul>").hover(function(){$(this).find("ul").not(":animated").slideDown(500)},function(){$(this).find("ul").not(":animated").slideUp(500)}).children("#albumList").delegate("a","click",function(){that.loadAlbum(this);return false})}else{setTimeout(checkProceed,5)}})()},loadAlbum:function(that){PicasaGallery.showLoader();var albumQuery="http://picasaweb.google.com/data/feed/base/user/"+options.username+"/albumid/"+(that.id||that)+"?alt=json&kind=photo&callback=?&hl=en_US";$.getJSON(albumQuery,function(data){var albumTitleHeading=$("#albumTitleHeading"),albumPhotos=[];if(!albumTitleHeading[0]){$("header h1").after('<h2 id="albumTitleHeading">'+data.feed.title.$t+"</h2>")}else{albumTitleHeading.empty().text(data.feed.title.$t)}var fullUrlToAlbum=data.feed.id.$t,albumId=fullUrlToAlbum.lastIndexOf("/");albumId=fullUrlToAlbum.slice(albumId+1);$.each(data.feed.entry,function(index){albumPhotos.push('<li class="tn"><a data-album-id="'+albumId+'" href="'+data.feed.entry[index].content.src+'"><img class="zoom" src="'+data.feed.entry[index].media$group.media$thumbnail[2].url+'" alt="'+data.feed.entry[index].title.$t+'" /></a></li>')});albums.html(albumPhotos.join(""));loader.fadeOut(200);$("html, body").animate({scrollTop:0},"fast");PicasaGallery.photoClick();var photoId=PicasaGallery.checkUrlKey("photoUrl");if(photoId){PicasaGallery.showLightbox(this,photoId);PicasaGallery.dropdownAlbums()}((albumListWrap===undefined)&&PicasaGallery.dropdownAlbums());var albumMeta=$("#albumOptions");albumMeta[0]&&albumMeta.remove();var contents='<div id="albumOptions"><h4><a id="copyMe">Get link to this album</a></h4>';if(!!that.getAttribute){contents+='<h4><a href="'+that.getAttribute("data-orig-href")+'">View on PicasaWeb</a></h4></div>'}$("footer").append(contents);PicasaGallery.clickToCopyText(that,"copyMe")})},showLightbox:function(that,photoPathTemp){var photoMeta=$(".photoMeta").hide();PicasaGallery.showLoader();if(!that.nodeName){that={href:$.urlParam("photoUrl"),id:$.urlParam("id")}}var overlay=$(".overlay");if(!overlay[0]){$('<div class="overlay"></div>').appendTo("body")}else{overlay.fadeIn(100)}if(typeof(that)==="undefined"){closeLightbox();return false}lightbox.children("img").remove();var img=new Image();$(img).hide().attr("src",that.href||photoPathTemp).css({maxWidth:$(window).width()-100,maxHeight:$(window).height()-100}).prependTo(lightbox).load(function(){photoMeta.html('<a href="?id='+(that.id||that.getAttribute("data-album-id"))+"&photoUrl="+that.href+'"><strong>Direct Link</strong></a><strong id="close"><a href="#">Close</a>').show();$(this).fadeIn(400);lightbox.center();loader.fadeOut(200)});$("body").click(function(){PicasaGallery.closeLightbox();$(".photoMeta").hide();if(location.search.indexOf("photoUrl")>-1){location.search=location.search.split("&photoUrl")[0]}});return that},closeLightbox:function(){lightbox.find("img").fadeOut(200,function(){$(this).remove();$("body > .overlay").fadeOut(100)});$(document).unbind("keydown");$(".photoMeta").empty()},listenForKeys:function(that){$(document).keydown(function(e){if(e.keyCode===39){var nextPhoto=$(that).parent("li").next("li").children("a")[0];that=PicasaGallery.showLightbox(nextPhoto)}if(e.keyCode===37){var prevPhoto=$(that).parent("li").prev("li").children("a")[0];that=PicasaGallery.showLightbox(prevPhoto)}if(e.keyCode===27){PicasaGallery.closeLightbox()}})},photoClick:function(){albums.delegate("a","click",function(e){that.showLightbox(this);that.listenForKeys(this);return false})},checkUrlKey:function(key){var albumKey=$.urlParam(key);if(albumKey){this.loadAlbum($.urlParam(key));return albumKey}return false},clickToCopyText:function(that,id){var clip=new ZeroClipboard.Client();clip.setText(that.href);clip.glue(id);clip.addEventListener("mouseUp",function(client){alert("The direct link to this album has been copied. Use Control/Command + V to paste.")})},clearCache:function(){$("footer").find("#clearCache").click(function(){localStorage.clear();window.location.reload()})},showLoader:function(){loader.css({top:($(window).height()-loader.height())/2+$(window).scrollTop()+"px",left:($(window).width()-loader.width())/2+$(window).scrollLeft()+"px"}).show()}};PicasaGallery.init()});var Slider={init:function(){this.f=document.forms[0];this.range=this.f.range;this.result=this.f.result;this.cachedRangeValue=window.localStorage&&localStorage.rangeValue?window.localStorage.rangeValue:7;this.imagesContainer=document.getElementById("albums");if(!this.understandsRange()){this.updateImages(7);$("html").addClass("noRange");return false}this.setValues();this.adjustImageSizing();this.save()},understandsRange:function(){var r=document.createElement("input");try{r.type="range"}catch(e){return false}if(r.type==="text"){this.range.style.display="none";return false}return true},setValues:function(){this.range.value=this.cachedRangeValue;typeof(this.result)!=="undefined"?(this.result.value=this.cachedRangeValue):null;this.updateImages(this.cachedRangeValue)},save:function(){this.range.addEventListener("mouseup",function(){localStorage?(localStorage.rangeValue=this.value):alert("Save data by some other method.")},false)},adjustImageSizing:function(){var that=this;this.range.addEventListener("change",function(){that.updateImages(this.value);typeof(that.result)!=="undefined"?(that.result.value=this.value):null},false)},updateImages:function(val){this.imagesContainer.className="t"+val}};Slider.init()}})(jQuery);