(function($){$.fn.antiscroll=function(options){return this.each(function(){if($(this).data("antiscroll")){$(this).data("antiscroll").destroy()}$(this).data("antiscroll",new $.Antiscroll(this,options))})};$.Antiscroll=Antiscroll;function Antiscroll(el,opts){this.el=$(el);this.options=opts||{};this.padding=undefined==this.options.padding?2:this.options.padding;this.inner=this.el.find(".antiscroll-inner");this.inner.css({width:"+="+scrollbarSize(),height:"+="+scrollbarSize()});if(this.inner.get(0).scrollWidth>this.el.width()){this.horizontal=new Scrollbar.Horizontal(this)}if(this.inner.get(0).scrollHeight>this.el.height()){this.vertical=new Scrollbar.Vertical(this)}}Antiscroll.prototype.destroy=function(){if(this.horizontal){this.horizontal.destroy()}if(this.vertical){this.vertical.destroy()}return this};function Scrollbar(pane){this.pane=pane;this.pane.el.append(this.el);this.innerEl=this.pane.inner.get(0);this.dragging=false;this.enter=false;this.shown=false;this.pane.el.mouseenter($.proxy(this,"mouseenter"));this.pane.el.mouseleave($.proxy(this,"mouseleave"));this.el.mousedown($.proxy(this,"mousedown"));this.pane.inner.scroll($.proxy(this,"scroll"));this.pane.inner.bind("mousewheel",$.proxy(this,"mousewheel"));var self=this;this.show();this.hiding=setTimeout($.proxy(this,"hide"),3000)}Scrollbar.prototype.destroy=function(){this.el.remove();return this};Scrollbar.prototype.mouseenter=function(){this.enter=true;this.show()};Scrollbar.prototype.mouseleave=function(){this.enter=false;if(!this.dragging){this.hide()}};Scrollbar.prototype.scroll=function(){if(!this.shown){this.show();if(!this.enter&&!this.dragging){this.hiding=setTimeout($.proxy(this,"hide"),1500)}}this.update()};Scrollbar.prototype.mousedown=function(ev){ev.preventDefault();this.dragging=true;this.startPageY=ev.pageY-parseInt(this.el.css("top"),10);this.startPageX=ev.pageX-parseInt(this.el.css("left"),10);document.onselectstart=function(){return false};var pane=this.pane,move=$.proxy(this,"mousemove"),self=this;$(document).mousemove(move).mouseup(function(){self.dragging=false;document.onselectstart=null;$(document).unbind("mousemove",move);if(!self.enter){self.hide()}})};Scrollbar.prototype.show=function(duration){if(!this.shown){this.update();this.el.addClass("antiscroll-scrollbar-shown");if(this.hiding){clearTimeout(this.hiding);this.hiding=null}this.shown=true}};Scrollbar.prototype.hide=function(){if(this.shown){this.el.removeClass("antiscroll-scrollbar-shown");this.shown=false}};Scrollbar.Horizontal=function(pane){this.el=$('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal">');Scrollbar.call(this,pane)};inherits(Scrollbar.Horizontal,Scrollbar);Scrollbar.Horizontal.prototype.update=function(){var paneWidth=this.pane.el.width(),trackWidth=paneWidth-this.pane.padding*2,innerEl=this.pane.inner.get(0);this.el.css("width",trackWidth*paneWidth/innerEl.scrollWidth).css("left",trackWidth*innerEl.scrollLeft/innerEl.scrollWidth)};Scrollbar.Horizontal.prototype.mousemove=function(ev){var trackWidth=this.pane.el.width()-this.pane.padding*2,pos=ev.pageX-this.startPageX,barWidth=this.el.width(),innerEl=this.pane.inner.get(0);var y=Math.min(Math.max(pos,0),trackWidth-barWidth);innerEl.scrollLeft=(innerEl.scrollWidth-this.pane.el.width())*y/(trackWidth-barWidth)};Scrollbar.Horizontal.prototype.mousewheel=function(ev,delta,x,y){if((x<0&&0==this.pane.inner.get(0).scrollLeft)||(x>0&&(this.innerEl.scrollLeft+this.pane.el.width()==this.innerEl.scrollWidth))){ev.preventDefault();return false}};Scrollbar.Vertical=function(pane){this.el=$('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical">');Scrollbar.call(this,pane)};inherits(Scrollbar.Vertical,Scrollbar);Scrollbar.Vertical.prototype.update=function(){var paneHeight=this.pane.el.height(),trackHeight=paneHeight-this.pane.padding*2,innerEl=this.innerEl;this.el.css("height",trackHeight*paneHeight/innerEl.scrollHeight).css("top",trackHeight*innerEl.scrollTop/innerEl.scrollHeight)};Scrollbar.Vertical.prototype.mousemove=function(ev){var paneHeight=this.pane.el.height(),trackHeight=paneHeight-this.pane.padding*2,pos=ev.pageY-this.startPageY,barHeight=this.el.height(),innerEl=this.innerEl;var y=Math.min(Math.max(pos,0),trackHeight-barHeight);innerEl.scrollTop=(innerEl.scrollHeight-paneHeight)*y/(trackHeight-barHeight)};Scrollbar.Vertical.prototype.mousewheel=function(ev,delta,x,y){if((y>0&&0==this.innerEl.scrollTop)||(y<0&&(this.innerEl.scrollTop+this.pane.el.height()==this.innerEl.scrollHeight))){ev.preventDefault();return false}};function inherits(ctorA,ctorB){function f(){}f.prototype=ctorB.prototype;ctorA.prototype=new f}var size;function scrollbarSize(){if(!size){var div=$('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>');$("body").append(div);var w1=$("div",div).innerWidth();div.css("overflow-y","scroll");var w2=$("div",div).innerWidth();$(div).remove();size=w1-w2}return size}})(jQuery);